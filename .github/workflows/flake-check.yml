name: Flake Health Check

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # Run weekly to catch dependency issues
    - cron: '0 0 * * 0'

jobs:
  flake-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Install Nix
      uses: cachix/install-nix-action@v25
      with:
        extra_nix_config: |
          experimental-features = nix-command flakes
    
    - name: Update flake inputs
      run: nix flake update --commit-lock-file || true
    
    - name: Check flake metadata
      run: nix flake metadata
    
    - name: Check flake outputs
      run: nix flake show
    
    - name: Verify flake lock
      run: nix flake check --no-build
    
    - name: Check for security advisories
      run: |
        nix run nixpkgs#vulnix -- --system x86_64-linux